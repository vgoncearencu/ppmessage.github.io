<!DOCTYPE html><html lang="en-US"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Run VPN client on Aliyun | Blog of PPMessage</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/pure-min.css"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Run VPN client on Aliyun</h1><a id="logo" href="/.">Blog of PPMessage</a><p class="description">Open Source Plug &amp; Play Customer Communication System</p></div><div id="nav-menu"><a href="/." class="current"><i class="icon-home"> Home</i></a><a href="/archives/"><i class="icon-archive"> Archive</i></a><a href="/about/"><i class="icon-about"> About</i></a><a href="/atom.xml"><i class="icon-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">Run VPN client on Aliyun</h1><div class="post-meta">2016-03-04 | </div><span data-disqus-identifier="2016/03/04/Run-VPN-client-on-Aliyun/" class="disqus-comment-count"></span><div class="post-content"><h1 id="在阿里云上通过VPN翻墙安装软件"><a href="#在阿里云上通过VPN翻墙安装软件" class="headerlink" title="在阿里云上通过VPN翻墙安装软件"></a>在阿里云上通过VPN翻墙安装软件</h1><blockquote>
<p>首先你要有个VPN（PPTP），如果没有VPN就不必往下看了</p>
</blockquote>
<h2 id="各种IP要区分清楚，"><a href="#各种IP要区分清楚，" class="headerlink" title="各种IP要区分清楚，"></a>各种IP要区分清楚，</h2><ul>
<li>阿里云服务器IP － 就是你的阿里云服务器IP，一般有两个，这里指那个外网IP；</li>
<li>阿里云服务器路由IP － 指默认路由对应的IP，可以通过route命令查到；</li>
<li>你自己的外网IP － 一般来说是你的路由器的外网IP，可以在登录阿里云的瞬间看到提示的那个就是了。</li>
<li>VPN远端IP － 成功连接VPN，会为本地ppp设备分配一个本地VPN IP，同时分配一个远端VPN IP，远端VPN IP，就是你用来翻墙的路由。</li>
</ul>
<h2 id="登录阿里云"><a href="#登录阿里云" class="headerlink" title="登录阿里云"></a>登录阿里云</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@ppmessage.com</span><br></pre></td></tr></table></figure>
<p>一般会提示：<br>Last login: Fri Mar  4 18:31:30 2016 from 123.116.51.166</p>
<p>您可能想这是上一次，你可以再登录一遍，试试, ^_^</p>
<p>123.116.51.166 就是你自己的外网IP.</p>
<h1 id="查看路由"><a href="#查看路由" class="headerlink" title="查看路由"></a>查看路由</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route -n</span><br></pre></td></tr></table></figure>
<p>输出类似：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         123.57.143.247  0.0.0.0         UG    0      0        0 eth1</span><br><span class="line">10.0.0.0        10.172.191.247  255.0.0.0       UG    0      0        0 eth0</span><br><span class="line">10.172.184.0    0.0.0.0         255.255.248.0   U     0      0        0 eth0</span><br><span class="line">100.64.0.0      10.172.191.247  255.192.0.0     UG    0      0        0 eth0</span><br><span class="line">106.185.41.129  123.57.143.247  255.255.255.255 UGH   0      0        0 eth1</span><br><span class="line">123.57.140.0    0.0.0.0         255.255.252.0   U     0      0        0 eth1</span><br><span class="line">123.116.51.166  123.57.143.247  255.255.255.255 UGH   0      0        0 eth1</span><br><span class="line">172.16.0.0      10.172.191.247  255.240.0.0     UG    0      0        0 eth0</span><br><span class="line">192.168.0.0     10.172.191.247  255.255.0.0     UG    0      0        0 eth0</span><br></pre></td></tr></table></figure>
<p>Destination 0.0.0.0 对应的 Gateway 就是阿里云服务器路由IP，123.57.143.247</p>
<h2 id="第一次配置路由"><a href="#第一次配置路由" class="headerlink" title="第一次配置路由"></a>第一次配置路由</h2><p>因为你与阿里云之间的网络连接不能断，所以在翻墙之前先为自己配置一条路由，并且删除默认路由</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">route add -host 你自己的外网IP gw 阿里云服务器路由IP</span><br><span class="line">route del -net 0.0.0.0 gw 阿里云服务器路由IP</span><br></pre></td></tr></table></figure>
<h2 id="建立VPN连接"><a href="#建立VPN连接" class="headerlink" title="建立VPN连接"></a>建立VPN连接</h2><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">pptpsetup</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">create</span> <span class="comment">vpnname</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">server</span> <span class="comment">vpn_server</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">username</span> <span class="comment">vpn_username</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">password</span> <span class="comment">vpn_password</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">encrypt</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">start</span></span><br></pre></td></tr></table></figure>
<p>如果成功会提示形如这样的结果</p>
<blockquote>
<p>local  IP address 10.85.92.24<br>remote IP address 10.85.92.1</p>
</blockquote>
<p>其实就是为你本地准备了一个IP，并且远端跟你相连的IP也告诉你了。</p>
<h2 id="第二次改路由"><a href="#第二次改路由" class="headerlink" title="第二次改路由"></a>第二次改路由</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route add default gw 10.85.92.1</span><br></pre></td></tr></table></figure>
<p>其中10.85.92.1就是VPN服务器为你分配的远端IP，那么你加入这个路由的目的就是让所有没有特殊指定的IP请求走这个远端IP。</p>
<h2 id="开始干活把"><a href="#开始干活把" class="headerlink" title="开始干活把"></a>开始干活把</h2><p>你是nodejs大侠还是ruby大神就可以开始了。</p>
<h2 id="第三次改路由"><a href="#第三次改路由" class="headerlink" title="第三次改路由"></a>第三次改路由</h2><p>用完之后再把路由改回来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">route del -net 0.0.0.0 gw VPN远端IP or route del default gw VPN远端IP</span><br><span class="line">route add default gw 阿里云服务器路由IP</span><br></pre></td></tr></table></figure>
<h2 id="删除VPN"><a href="#删除VPN" class="headerlink" title="删除VPN"></a>删除VPN</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pptpsetup --delete vpnname</span><br></pre></td></tr></table></figure>
<h2 id="值得注意的事情"><a href="#值得注意的事情" class="headerlink" title="值得注意的事情"></a>值得注意的事情</h2><p>如果路由没配好，把自己和阿里云的连接断掉了，只有登录阿里云的控制台重启了，我也重启了好几遍呢.</p>
</div><div class="tags"></div><div class="post-nav"><a href="/2016/03/04/Deploy-PPMessage-with-Docker/" class="pre"><i class="icon-previous">PPMessage &amp; Docker</i></a><a href="/2016/03/04/Run-PPMessage-on-Mac-OS-X/" class="next">Run PPMessage on Mac OS X<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'ppmessageblog';
var disqus_identifier = '2016/03/04/Run-VPN-client-on-Aliyun/';
var disqus_title = 'Run VPN client on Aliyun';
var disqus_url = 'http://yoursite.com/2016/03/04/Run-VPN-client-on-Aliyun/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//ppmessageblog.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title">Categories</div></div><div class="widget"><div class="widget-title">Tags</div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title">Recent</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/05/05/PPMessage-Configurations/">PPMessage-Configurations</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/03/Install-PPMessage-on-Ubuntu-Server/">Install PPMessage on Ubuntu Server</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/03/Install-PPMessage-on-Debian-8-04-Jessie/">Install PPMessage on Debian 8.04 (Jessie)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/09/PPMessage-An-Open-Source-Realtime-Online-Customer-Communication-Platform-3/">PPMessage - An Open Source Realtime Online Customer Communication Platform - (3)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/08/PPMessage-An-Open-Source-Realtime-Online-Customer-Communication-Platform-2/">PPMessage - An Open Source Realtime Online Customer Communication Platform - (2)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/08/PPMessage-An-Open-Source-Realtime-Online-Customer-Communication-Platform-1/">PPMessage - An Open Source Realtime Online Customer Communication Platform - (1)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/08/Deploy-PPMessage-on-Linux/">Deploy PPMessage on Linux</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/08/Deploy-PPMessage-on-Mac/">Deploy PPMessage on Mac</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/04/Deploy-PPMessage-with-Docker/">PPMessage & Docker</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/04/Run-VPN-client-on-Aliyun/">Run VPN client on Aliyun</a></li></ul></div><div class="widget"><div class="widget-title">Recent Comments</div><script type="text/javascript" src="//ppmessageblog.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title">Blogroll</div><ul></ul><a href="http://www.ppmessage.com/" title="PPMessage Home" target="_blank">PPMessage Home</a></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">Blog of PPMessage.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js"></script>
<script src="/js/totop.js"></script><script src="/js/fancybox.pack.js"></script>
<script src="/js/jquery.fancybox.js"></script><link rel="stylesheet" href="/css/jquery.fancybox.css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-72560081-1','auto');ga('send','pageview');
</script></div></body></html>